!function(t){t(function(){var e=wc_ps_results_vars.legacy_api_url,s=wc_ps_results_vars.permalink_structure,i={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g},i.models.Item=Backbone.Model.extend({defaults:{title:"Empty Product",url:null,image_url:null,sku:null,price:null,description:null,addtocart:null,categories:[],tags:[],type:"product",status:!0}}),i.collections.Items=Backbone.Collection.extend({model:i.models.Item}),i.views.Item=Backbone.View.extend({tagName:"div",className:"rs_result_row",template:_.template(t("#wc_psearch_result_itemTpl").html()),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),i.views.ResultContainer=Backbone.View.extend({cached:{},addCache:function(t,e,s){this.cached[t+"-"+e]=s},flushCached:function(){this.cached={}},events:{"click .ps_navigation":"initRouter"},initRouter:function(e){e.preventDefault();var s=t(e.target),i=s.data("href");Backbone.history.navigate(i,{trigger:!0})},footerTpl:_.template(t("#wc_psearch_result_footerTpl").html()),initialize:function(){this.total_items=0,this.search_in=wc_ps_results_vars.search_in,this.next_page_number=1,this.is_first_load=!0,this.listenTo(this.collection,"add",this.addItem),this.list_items_container=this.$("#ps_list_items_container"),this.footer=this.$("#ps_footer_container"),this.ps_more_check=this.$("#ps_more_check"),this.ps_more_result_popup=this.$("#ps_more_result_popup"),this.ps_no_more_result_popup=this.$("#ps_no_more_result_popup"),this.ps_fetching_result_popup=this.$("#ps_fetching_result_popup"),this.ps_no_result_popup=this.$("#ps_no_result_popup"),this.endless_loading=!1,t(window).scroll(function(){this.next_page_number>1&&this.endlessScrollLoad()}.bind(this))},render:function(){return this.footer.html(this.footerTpl({next_page_number:this.next_page_number,first_load:this.is_first_load,total_items:this.total_items})),this},addItem:function(t){var e=new i.views.Item({model:t});this.list_items_container.append(e.render().el),this.list_items_container.append('<div style="clear:both"></div>')},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),!1},routeSearchIn:function(){this.total_items=0,this.next_page_number=1,this.is_first_load=!0,this.endless_loading=!1,this.clearAll(),this.getItems()},getItems:function(){this.cached[this.search_in+"-"+this.next_page_number]?(item_list=this.cached[this.search_in+"-"+this.next_page_number],this.addItems(item_list)):(this.is_first_load?this.ps_fetching_result_popup.fadeIn("fast"):this.ps_more_result_popup.fadeIn("fast"),t.get(e,{search_in:this.search_in,psp:this.next_page_number},function(t){this.addCache(this.search_in,this.next_page_number,t),this.addItems(t),this.is_first_load?this.ps_fetching_result_popup.fadeOut("normal"):this.ps_more_result_popup.fadeOut("normal"),0==t.total&&(this.is_first_load?this.ps_no_result_popup.fadeIn("normal").fadeOut(1e3):this.ps_no_more_result_popup.fadeIn("normal").fadeOut(1e3))}.bind(this)))},addItems:function(e){this.$(".ps_heading_search_in_name").html(e.search_in_name),e.total>0?(this.total_items+=e.items.length,t.each(e.items,function(t,e){this.collection.add(e)}.bind(this)),e.total>e.items.length?(this.next_page_number++,this.render(),this.endless_loading=!1):(this.next_page_number=0,this.render())):(this.next_page_number=0,this.render())},endlessScrollLoad:function(){if(0==this.endless_loading){var e=t("#ps_more_check").offset().top+this.ps_more_check.height()>=t(window).scrollTop(),s=t("#ps_more_check").offset().top<=t(window).scrollTop()+t(window).height();e&&s&&(this.endless_loading=!0,this.is_first_load=!1,this.getItems())}}}),i.apps.App=Backbone.Router.extend({routes:{"?:query_parameters":"getResults_QueryString","keyword/:s_k/search-in/:s_in":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/cat-in/:c_in/search-other/:s_other":"getResults","keyword/:s_k/search-in/:s_in/search-other/:s_other/cat-in/:c_in":"getResults"},initialize:function(){this.collection=new i.collections.Items,this.resultCointainerView=new i.views.ResultContainer({collection:this.collection,el:t("#ps_results_container")}),Backbone.history&&Backbone.history.start({pushState:!0,root:wc_ps_results_vars.search_page_path}),Backbone.history.navigate(wc_ps_results_vars.default_navigate,{trigger:!0})},getResults:function(t,e){this.resultCointainerView.search_in=e,this.resultCointainerView.$(".ps_navigation").removeClass("ps_navigation_activated"),this.resultCointainerView.$(".ps_navigation"+e).addClass("ps_navigation_activated"),this.resultCointainerView.routeSearchIn()},getResults_QueryString:function(t){if(""==s){var e=this.parseQueryString(t);this.resultCointainerView.search_in=e.search_in,this.resultCointainerView.$(".ps_navigation").removeClass("ps_navigation_activated"),this.resultCointainerView.$(".ps_navigation"+e.search_in).addClass("ps_navigation_activated"),this.resultCointainerView.routeSearchIn()}},parseQueryString:function(t){var e={};return t&&_.each(_.map(decodeURI(t).split(/&/g),function(t){var e=t.split("="),s={};if(e.length>=1){var i=void 0;2==e.length&&(i=e[1]),s[e[0]]=i}return s}),function(t){_.extend(e,t)}),e}}),wc_ps_app.addInitializer(function(){new i.apps.App})})}(jQuery);